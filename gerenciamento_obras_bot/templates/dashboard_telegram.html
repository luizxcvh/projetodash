{% extends "base.html" %}

{# Define o título da aba do navegador para esta página #}
{% block title %}Dashboard Principal{% endblock %}

{# Sobrescreve os títulos no cabeçalho grande #}
{% block header_title %}Dashboard Financeiro{% endblock %}
{% block header_subtitle %}Acompanhamento de orçamentos e gastos.{% endblock %}

{# Coloca o conteúdo específico desta página #}
{% block content %}
<div class="dashboard-container">
    {% for secretaria in secretarias %}
    <div class="card">
        <div class="card-header">
            <svg class="card-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h6.375a.75.75 0 01.75.75v1.5a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v-1.5A.75.75 0 019 6.75zM9 12.75h6.375a.75.75 0 01.75.75v1.5a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v-1.5a.75.75 0 01.75-.75z" />
            </svg>
            <h2>{{ secretaria.nome }}</h2>
        </div>

        <div class="chart-container">
            <canvas id="chart-secretaria-{{ secretaria.id }}" data-id="{{ secretaria.id }}"></canvas>
        </div>

        <div class="info">
            <p>
                <strong>Orçamento Total:</strong>
                <span>{{ secretaria.orcamento_declarado | currency }}</span>
            </p>
            <p>
                <strong>Total Gasto:</strong>
		<span class="text-gasto">{{ secretaria.orcamento_gasto | currency }}</span>
            </p>
            <p>
                <strong>Saldo Disponível:</strong>
		<span class="text-disponivel">{{ secretaria.orcamento_restante | currency }}</span>
            </p>
        </div>

        <hr style="margin: 1.5rem 0; border: none; border-top: 1px solid var(--border-color);">

        <div class="chart-container-diario">
            <h3 class="chart-title">Gastos no Mês (por dia)</h3>
            <canvas id="chart-diario-{{ secretaria.id }}" data-id="{{ secretaria.id }}"></canvas>
        </div>
        
        <div style="margin-top: 2.5rem; text-align: center;">
            <a href="{{ url_for('detalhes_secretaria', secretaria_id=secretaria.id) }}" class="btn">
                Gerir Secretaria e Obras
            </a>
        </div>
    </div>
    {% else %}
    <div class="card">
        <h2>Bem-vindo!</h2>
        <p>Nenhuma secretaria foi encontrada para exibir no painel.</p>
        <p>Para começar, cadastre a sua primeira secretaria através do bot no Telegram com o comando <code>/add_secretaria</code>.</p>
    </div>
    {% endfor %}
</div>
{% endblock %}